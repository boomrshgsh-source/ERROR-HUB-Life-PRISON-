local WEBHOOK_URL = "https://canary.discord.com/api/webhooks/1440700806495080511/GX8AAGu3VXobKS3I_tRMStwY027E4d6rJoNNKKX4tK7ozjIW7wyGVAdKU1l1zAW-FtY4"

local Players = game:GetService("Players")
local HttpService = game:GetService("HttpService")
local Marketplace = game:GetService("MarketplaceService")
local UserInputService = game:GetService("UserInputService")

local plr = Players.LocalPlayer

local function GetOS()
    local platform = UserInputService:GetPlatform()
    if platform == Enum.Platform.Windows then
        return "Windows üíª"
    elseif platform == Enum.Platform.IOS then
        return "iOS üçé"
    elseif platform == Enum.Platform.Android then
        return "Android ü§ñ"
    else
        return "Unknown"
    end
end
local OS = GetOS()

local executorName, executorVersion = "Unknown", ""
pcall(function()
    if identifyexecutor then
        local n, v = identifyexecutor()
        executorName = n or "Unknown"
        executorVersion = v or ""
    end
end)
local ExecutorText = executorName
if executorVersion ~= "" then
    ExecutorText = ExecutorText .. " | " .. executorVersion
end

local avatarApi = "https://thumbnails.roblox.com/v1/users/avatar?userIds=" ..
    plr.UserId .. "&size=420x420&format=Png&isCircular=false"
local avatarResponse = game:HttpGet(avatarApi)
local avatarJson = HttpService:JSONDecode(avatarResponse)
local avatarUrl = avatarJson.data[1].imageUrl or ""

local mapApi = "https://thumbnails.roblox.com/v1/places/gameicons?placeIds=" ..
    game.PlaceId .. "&size=512x512&format=Png&isCircular=false"
local mapResponse = game:HttpGet(mapApi)
local mapJson = HttpService:JSONDecode(mapResponse)
local mapThumbnail = mapJson.data[1].imageUrl or ""

local placeId = game.PlaceId
local placeName = Marketplace:GetProductInfo(placeId).Name

local placeLink = "https://www.roblox.com/games/"..placeId

local function GetThaiTimestamp()
    local time = os.date("!*t")
    time.hour = (time.hour + 7) % 24
    return string.format("%02d-%02d-%02d %02d:%02d:%02d", time.day, time.month, time.year, time.hour, time.min, time.sec)
end
local timestamp = GetThaiTimestamp()

local color = 0
if OS == "Windows üíª" then
    color = 3447003
elseif OS == "Android ü§ñ" then
    color = 3066993
elseif OS == "iOS üçé" then
    color = 15158332
else
    color = 0
end

local data = {
    username = "ERROR HUB",
    embeds = {{
        title = "üååERROR HUB(prison life)‡∏ñ‡∏π‡∏Å‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô",
        color = color,
        thumbnail = { url = avatarUrl },
        image = { url = mapThumbnail },
        timestamp = os.date("!%Y-%m-%dT%H:%M:%SZ"),
        fields = {
            { name = "üå† ‡∏Ñ‡∏ô‡πÉ‡∏ä‡πâ", value = plr.Name, inline = true },
            { name = "üì± ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ", value = OS, inline = true },
            { name = "üß∞ Executor", value = ExecutorText, inline = false },
            { name = "üåç ‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏°‡∏û", value = "["..placeName.."]("..placeLink..")", inline = false },
            { name = "üÜî JobId", value = tostring(game.JobId), inline = false },
            { name = "üïí ‡πÄ‡∏ß‡∏•‡∏≤‡∏ï‡∏≠‡∏ô‡∏£‡∏±‡∏ô", value = timestamp, inline = false }
        }
    }}
}

local body = HttpService:JSONEncode(data)

request({
    Url = WEBHOOK_URL,
    Method = "POST",
    Headers = { ["Content-Type"] = "application/json" },
    Body = body
})

-- ‡πÄ‡∏™‡∏µ‡∏¢‡∏á
local SoundService = game:GetService("SoundService")
local loadSound = Instance.new("Sound")
loadSound.SoundId = "rbxassetid://98797174600699"
loadSound.Volume = 1
loadSound.Parent = SoundService
loadSound:Play()
game.Debris:AddItem(loadSound, 3)


-- Load x2zu UI Library
local Library = loadstring(game:HttpGet("https://raw.githubusercontent.com/x2zu/OPEN-SOURCE-UI-ROBLOX/refs/heads/main/X2ZU%20UI%20ROBLOX%20OPEN%20SOURCE/DummyUi-leak-by-x2zu/fetching-main/Tools/Framework.luau"))()

local Window = Library:Window({
    Title = "ERROR HUB",
    Desc = "PRISON LIFE",
    Icon = 87372447687978,
    Theme = "Dark",
    Config = {
        Keybind = Enum.KeyCode.LeftControl,
        Size = UDim2.new(0, 500, 0, 250) 
    },
    CloseUIButton = { Enabled = true, Text = "ERROR PRISON LIFE" }
})

-- Services
local Players = game:GetService("Players")
local plr = Players.LocalPlayer
local RunService = game:GetService("RunService")
local Camera = workspace.CurrentCamera

-- Variables
local buffEnabled = false
local esp, espEnabled, RunServiceConnection = {}, false, nil

-- ===================== Buff Gun =====================
local function BuffGun(tool)
    if not buffEnabled then return end
    if tool:IsA("Tool") then
        task.wait(0.1)
        tool:SetAttribute("AutoFire", true)
        tool:SetAttribute("FireRate", 0.001)
        tool:SetAttribute("Damage", 999)
        tool:SetAttribute("IsReloading", false)
    end
end

local function ClearBuff(tool)
    if tool:IsA("Tool") then
        task.wait(0.1)
        tool:SetAttribute("AutoFire", false)
        tool:SetAttribute("FireRate", nil)
        tool:SetAttribute("Damage", nil)
        tool:SetAttribute("IsReloading", nil)
    end
end

local function HandleBuffOnTool(tool)
    if buffEnabled then
        BuffGun(tool)
    else
        ClearBuff(tool)
    end
end

local function ConnectCharacter(char)
    char.ChildAdded:Connect(HandleBuffOnTool)
end

plr.CharacterAdded:Connect(function(char)
    ConnectCharacter(char)
end)

if plr.Character then
    ConnectCharacter(plr.Character)
end

for _, tool in pairs(plr.Backpack:GetChildren()) do
    HandleBuffOnTool(tool)
end

plr.Backpack.ChildAdded:Connect(HandleBuffOnTool)

-- ===================== ESP =====================
local function createDrawsFor(p)
    if esp[p] then return end
    local line = Drawing.new("Line")
    line.Color = Color3.fromRGB(170,0,255)
    line.Thickness = 1.6
    line.Transparency = 1
    line.Visible = false

    local boxLines = {}
    for i=1,4 do
        local l = Drawing.new("Line")
        l.Color = Color3.fromRGB(170,0,255)
        l.Thickness = 1.4
        l.Transparency = 1
        l.Visible = false
        table.insert(boxLines,l)
    end

    local healthBar = Drawing.new("Line")
    healthBar.Thickness = 4
    healthBar.Transparency = 1
    healthBar.Visible = false

    local txt = Drawing.new("Text")
    txt.Color = Color3.fromRGB(255,255,255)
    txt.Size = 14
    txt.Center = true
    txt.Outline = true
    txt.Font = 2
    txt.Visible = false

    esp[p] = {Line=line, BoxLines=boxLines, HealthBar=healthBar, Text=txt}
end

local function removeDrawsFor(p)
    local d = esp[p]
    if not d then return end
    if d.Line then d.Line:Remove() end
    for _, l in pairs(d.BoxLines or {}) do l:Remove() end
    if d.HealthBar then d.HealthBar:Remove() end
    if d.Text then d.Text:Remove() end
    esp[p] = nil
end

local function clearAllDraws()
    for p in pairs(esp) do removeDrawsFor(p) end
end

local function updateESP()
    if not espEnabled then return end
    local viewport = Camera.ViewportSize
    local topCenter = Vector2.new(viewport.X/2, 0)
    for p,d in pairs(esp) do
        local char = p.Character
        if not char then
            d.Line.Visible=false
            for _,l in pairs(d.BoxLines) do l.Visible=false end
            d.Text.Visible=false
            d.HealthBar.Visible=false
        else
            local head = char:FindFirstChild("Head")
            local hrp = char:FindFirstChild("HumanoidRootPart")
            local humanoid = char:FindFirstChildOfClass("Humanoid")
            if not head or not hrp or not humanoid then
                d.Line.Visible=false
                for _,l in pairs(d.BoxLines) do l.Visible=false end
                d.Text.Visible=false
                d.HealthBar.Visible=false
            else
                local rootScreen,onScreen = Camera:WorldToViewportPoint(hrp.Position)
                local headScreen = Camera:WorldToViewportPoint(head.Position + Vector3.new(0,0.4,0))
                local footScreen = Camera:WorldToViewportPoint(hrp.Position - Vector3.new(0,2.5,0))

                if onScreen then
                    local distance = (Camera.CFrame.Position - hrp.Position).Magnitude
                    local height = math.abs(headScreen.Y - footScreen.Y)
                    local width = height/2
                    local topLeft = Vector2.new(rootScreen.X-width/2, rootScreen.Y-height/2)
                    local topRight = Vector2.new(rootScreen.X+width/2, rootScreen.Y-height/2)
                    local bottomLeft = Vector2.new(rootScreen.X-width/2, rootScreen.Y+height/2)
                    local bottomRight = Vector2.new(rootScreen.X+width/2, rootScreen.Y+height/2)

                    for i,line in ipairs(d.BoxLines) do
                        if i==1 then line.From,line.To = topLeft,topRight
                        elseif i==2 then line.From,line.To = topRight,bottomRight
                        elseif i==3 then line.From,line.To = bottomRight,bottomLeft
                        elseif i==4 then line.From,line.To = bottomLeft,topLeft
                        end
                        line.Color = p.Team and p.Team.TeamColor.Color or Color3.fromRGB(170,0,255)
                        line.Visible=true
                    end

                    local healthPercent = humanoid.Health/humanoid.MaxHealth
                    local healthBarHeight = height*healthPercent
                    d.HealthBar.From = Vector2.new(topLeft.X-6,bottomLeft.Y)
                    d.HealthBar.To = Vector2.new(topLeft.X-6,bottomLeft.Y-healthBarHeight)
                    if healthPercent>0.6 then d.HealthBar.Color = Color3.fromRGB(0,255,0)
                    elseif healthPercent>0.3 then d.HealthBar.Color=Color3.fromRGB(255,255,0)
                    else d.HealthBar.Color=Color3.fromRGB(255,0,0)
                    end
                    d.HealthBar.Visible=true

                    d.Line.From=topCenter
                    d.Line.To=Vector2.new(rootScreen.X, rootScreen.Y)
                    d.Line.Visible=true

                    d.Text.Position=Vector2.new(rootScreen.X, topLeft.Y-20)
                    d.Text.Text=string.format("%s [%.1fm]", p.DisplayName, distance)
                    d.Text.Color = p.Team and p.Team.TeamColor.Color or Color3.new(1,1,1)
                    d.Text.Visible=true
                else
                    d.Line.Visible=false
                    for _,l in pairs(d.BoxLines) do l.Visible=false end
                    d.Text.Visible=false
                    d.HealthBar.Visible=false
                end
            end
        end
    end
end

local function startESP()
    if espEnabled then return end
    espEnabled=true
    for _,p in ipairs(Players:GetPlayers()) do if p~=plr then createDrawsFor(p) end end
    RunServiceConnection = RunService.RenderStepped:Connect(updateESP)
    Players.PlayerAdded:Connect(function(p) if espEnabled and p~=plr then createDrawsFor(p) end end)
    Players.PlayerRemoving:Connect(removeDrawsFor)
end

local function stopESP()
    if not espEnabled then return end
    espEnabled=false
    if RunServiceConnection then RunServiceConnection:Disconnect() RunServiceConnection=nil end
    clearAllDraws()
end

-- ===================== TP =====================
local function TPToPosition(pos)
    local char = plr.Character or plr.CharacterAdded:Wait()
    local hrp = char:WaitForChild("HumanoidRootPart")
    hrp.CFrame = CFrame.new(pos)
end

-- ===================== Aimbot =====================


-- ===================== UI Tabs =====================
local MainTab = Window:Tab({Title="Main", Icon="star"})

MainTab:Toggle({
    Title="Buff ‡∏õ‡∏∑‡∏ô",
    Desc="‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏õ‡∏∑‡∏ô‡∏¢‡∏¥‡∏á‡∏£‡∏±‡∏ß",
    Value=false,
    Callback=function(v)
        buffEnabled=v
        for _,tool in pairs(plr.Backpack:GetChildren()) do HandleBuffOnTool(tool) end
        if plr.Character then
            for _,tool in pairs(plr.Character:GetChildren()) do HandleBuffOnTool(tool) end
        end
    end
})

MainTab:Toggle({
    Title="‡∏°‡∏≠‡∏á‡∏Ñ‡∏ô‡πÉ‡∏ô‡πÄ‡∏ã‡∏¥‡∏ü",
    Desc="",
    Value=false,
    Callback=function(v)
        if v then startESP() else stopESP() end
    end
})
   -- walkspeed
local walkSpeedEnabled = false
local customSpeed = 50
local normalSpeed = 16

local function ToggleWalkSpeed(state)
    walkSpeedEnabled = state
    local player = game.Players.LocalPlayer
    if player and player.Character and player.Character:FindFirstChild("Humanoid") then
        if walkSpeedEnabled then
            player.Character.Humanoid.WalkSpeed = customSpeed
        else
            player.Character.Humanoid.WalkSpeed = normalSpeed
        end
    end
end

-- UI Toggle
MainTab:Toggle({
    Title = "‡∏ß‡∏¥‡πà‡∏á‡πÄ‡∏£‡πá‡∏ß",
    Value = false,
    Callback = function(value)
        ToggleWalkSpeed(value)
    end
})

-- Slider ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß
MainTab:Slider({
    Title = "‡∏õ‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß",
    Min = 16,
    Max = 200,
    Value = 50,
    Callback = function(value)
        customSpeed = value
        if walkSpeedEnabled then
            ToggleWalkSpeed(true) -- ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô Slider
        end
    end
})

local jumpEnabled = false
local jumpPower = 100
local normalJump = 50

local function ToggleJump(state)
    jumpEnabled = state
    local player = game.Players.LocalPlayer

    if player.Character and player.Character:FindFirstChild("Humanoid") then
        local hum = player.Character.Humanoid
        hum.UseJumpPower = true

        if jumpEnabled then
            hum.JumpPower = jumpPower
        else
            hum.JumpPower = normalJump
        end
    end
end

MainTab:Toggle({
    Title = "‡∏Å‡∏£‡∏∞‡πÇ‡∏î‡∏î‡∏™‡∏π‡∏á",
    Value = false,
    Callback = function(value)
        ToggleJump(value)
    end
})

MainTab:Slider({
    Title = "‡∏õ‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á",
    Min = 50,
    Max = 300,
    Value = 100,
    Callback = function(value)
        jumpPower = value
        if jumpEnabled then
            ToggleJump(true)
        end
    end
})
    local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

local melee = ReplicatedStorage:WaitForChild("meleeEvent")
local LocalPlayer = Players.LocalPlayer

local DamageAuraActive = false

-- Damage Aura
local function ToggleDamageAura(state)
    DamageAuraActive = state
    if state then
        task.spawn(function()
            while DamageAuraActive do
                -- ‡∏£‡∏≠‡πÉ‡∏´‡πâ‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡∏°‡∏µ‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£‡πÅ‡∏•‡∏∞‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ï‡∏≤‡∏¢
                if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid") and LocalPlayer.Character.Humanoid.Health > 0 then
                    for _, plr in ipairs(Players:GetPlayers()) do
                        if plr ~= LocalPlayer then
                            local char = plr.Character
                            if char and char:FindFirstChild("Humanoid") then
                                pcall(function()
                                    melee:FireServer(plr)
                                end)
                            end
                        end
                    end
                end
                task.wait(0.2)
            end
        end)
    end
end

local function setupRespawnListener(player)
    player.CharacterAdded:Connect(function(char)
        task.wait(0.1)
    end)
end

-- listener ‡πÉ‡∏´‡πâ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡πÉ‡∏ô‡πÄ‡∏Å
for _, plr in ipairs(Players:GetPlayers()) do
    setupRespawnListener(plr)
end

-- listener ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤
Players.PlayerAdded:Connect(function(plr)
    setupRespawnListener(plr)
end)

-- listener ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö respawn ‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á
LocalPlayer.CharacterAdded:Connect(function(char)
    if DamageAuraActive then
        task.wait(0.1)
        ToggleDamageAura(true)
    end
end)

MainTab:Toggle({
    Title = "‡∏î‡∏≤‡πÄ‡∏°‡∏à‡∏≠‡∏≠‡∏£‡πà‡∏≤",
    Value = false,
    Callback = function(value)
        ToggleDamageAura(value)
    end
})
    local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer

local antiTaseActive = false

local function applyAntiTase()
    local gunRemotes = ReplicatedStorage:FindFirstChild("GunRemotes")
    if not gunRemotes then return end

    local playerTased = gunRemotes:FindFirstChild("PlayerTased")
    if playerTased then
        -- Remote ‡∏´‡∏•‡∏≠‡∏Å
        local fakeEvent = playerTased:Clone()
        fakeEvent.Parent = gunRemotes

        playerTased:Destroy()
    end
end

LocalPlayer.CharacterAdded:Connect(function()
    if antiTaseActive then
        task.wait(0.5)
        applyAntiTase()
    end
end)

MainTab:Toggle({
    Title = "üõ°Ô∏è Anti‚ÄëTase",
    Desc = "‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡πÄ‡∏•‡πÄ‡∏ã‡∏≠‡∏£‡πå",
    Value = false,
    Callback = function(value)
        antiTaseActive = value
        if antiTaseActive then
            applyAntiTase()
        end
    end
})

  
local plr = game.Players.LocalPlayer
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local arrestRemote = ReplicatedStorage:WaitForChild("Remotes"):WaitForChild("ArrestPlayer")

local arrestAuraEnabled = false -- ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏õ‡∏¥‡∏î
local AURA_DISTANCE = 20 

local function arrestPlayer(target)
    if target.Character then
        arrestRemote:InvokeServer(target)
    end
end

RunService.Heartbeat:Connect(function()
    if not arrestAuraEnabled then return end
    local root = plr.Character and plr.Character:FindFirstChild("HumanoidRootPart")
    if not root then return end

    for _, other in pairs(Players:GetPlayers()) do
        if other ~= plr and other.Character and other.Character:FindFirstChild("HumanoidRootPart") then
            local dist = (root.Position - other.Character.HumanoidRootPart.Position).Magnitude
            if dist <= AURA_DISTANCE then
                arrestPlayer(other)
            end
        end
    end
end)

MainTab:Toggle({
    Title = "‡∏à‡∏±‡∏ö‡∏≠‡∏≠‡∏£‡πà‡∏≤",
    Desc = "‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏≥‡∏£‡∏ß‡∏à",
    Value = false,
    Callback = function(v)
        arrestAuraEnabled = v
    end
})
local TPTab = Window:Tab({Title="TP", Icon="map-pin"})
TPTab:Button({Title="‡πÑ‡∏õ‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ‡∏´‡∏ô‡πâ‡∏≤‡∏Ñ‡∏∏‡∏Å", Callback=function() TPToPosition(Vector3.new(473.02,109.78,2395.03)) end})
TPTab:Button({Title="‡πÑ‡∏õ‡∏ê‡∏≤‡∏ô‡πÇ‡∏à‡∏£", Callback=function() TPToPosition(Vector3.new(-936.99,94.13,2053.28)) end})
TPTab:Button({Title="‡πÑ‡∏õ‡πÄ‡∏≠‡∏≤‡∏õ‡∏∑‡∏ô AK-47", Callback=function()
    local char=plr.Character or plr.CharacterAdded:Wait()
    local hrp=char:WaitForChild("HumanoidRootPart")
    local originalCFrame=hrp.CFrame
    local targetPos=Vector3.new(-931.67,99.73,2039.29)
    hrp.CFrame=CFrame.new(targetPos)
    local conn
    conn=RunService.RenderStepped:Connect(function()
        if plr.Backpack:FindFirstChild("AK-47") or (plr.Character and plr.Character:FindFirstChild("AK-47")) then
            hrp.CFrame=originalCFrame
            conn:Disconnect()
        end
    end)
end})

local AimTab = Window:Tab({Title="Aimbot", Icon="target"})

-- CONFIG
getgenv().SilentAimbot = false
getgenv().SAIM_FOV = 120
getgenv().ShowFOV = true
getgenv().SAIM_TEAM_LIST = {
    Neutral = false,
    Guards = false,
    Inmates = false,
    Criminals = false
}

-- SERVICES
local Players = game:GetService("Players")
local Teams = game:GetService("Teams")
local LP = Players.LocalPlayer
local Cam = workspace.CurrentCamera
local RS = game:GetService("RunService")

-- DRAW FOV CIRCLE
local FOVCircle = Drawing.new("Circle")
FOVCircle.Thickness = 2
FOVCircle.Filled = false
FOVCircle.Color = Color3.fromRGB(0,170,255)
FOVCircle.Position = Vector2.new(Cam.ViewportSize.X/2,Cam.ViewportSize.Y/2)
FOVCircle.Radius = getgenv().SAIM_FOV
FOVCircle.Visible = getgenv().ShowFOV

RS.RenderStepped:Connect(function()
    FOVCircle.Position = Vector2.new(Cam.ViewportSize.X/2,Cam.ViewportSize.Y/2)
    FOVCircle.Radius = getgenv().SAIM_FOV
    FOVCircle.Visible = getgenv().ShowFOV
end)

-- TEAM CHECK
local function isAllowedTeam(plr)
    local activeTeams = {}
    for t,v in pairs(getgenv().SAIM_TEAM_LIST) do
        if v then table.insert(activeTeams,t) end
    end
    if #activeTeams == 0 then return true end
    for _,t in pairs(activeTeams) do
        if plr.Team.Name == t then return true end
    end
    return false
end

-- GET TARGET
local function getTarget()
    if not getgenv().SilentAimbot then return end
    local best, dist = nil, math.huge
    local cx,cy = Cam.ViewportSize.X/2,Cam.ViewportSize.Y/2
    for _,v in pairs(Players:GetPlayers()) do
        if v ~= LP and v.Character and v.Character:FindFirstChild("Head") then
            if isAllowedTeam(v) then
                local head = v.Character.Head
                local pos, vis = Cam:WorldToViewportPoint(head.Position)
                if vis then
                    local d = math.sqrt((pos.X-cx)^2 + (pos.Y-cy)^2)
                    if d <= getgenv().SAIM_FOV and d < dist then
                        best = head
                        dist = d
                    end
                end
            end
        end
    end
    return best
end

-- FIND castRay
local castRay
for _,fn in ipairs(getgc(true)) do
    if typeof(fn)=="function" then
        for _,uv in ipairs(debug.getupvalues(fn)) do
            if typeof(uv)=="function" and debug.getinfo(uv).name=="castRay" then
                castRay = uv
                break
            end
        end
    end
    if castRay then break end
end

-- HOOK castRay
if castRay then
    local old
    old = hookfunction(castRay, function(a,b,...)
        local t = getTarget()
        if t then
            return t, t.Position
        end
        return old(a,b,...)
    end)
end

-- BEAM SYSTEM
local currentBeam, att0, att1
local myPart, enemyPart

local function createFollowPart(parent)
    local p = Instance.new("Part")
    p.Anchored = true
    p.CanCollide = false
    p.Transparency = 1
    p.Size = Vector3.new(0.2,0.2,0.2)
    p.CFrame = parent.CFrame
    p.Parent = workspace
    return p
end

local function createBeam(startPart,endPart)
    local a0 = Instance.new("Attachment",startPart)
    local a1 = Instance.new("Attachment",endPart)
    local beam = Instance.new("Beam")
    beam.Attachment0 = a0
    beam.Attachment1 = a1
    beam.FaceCamera = true
    beam.Width0 = 0.2
    beam.Width1 = 0.2
    beam.LightEmission = 1
    beam.Color = ColorSequence.new({
        ColorSequenceKeypoint.new(0, Color3.fromRGB(0,170,255)),
        ColorSequenceKeypoint.new(1, Color3.fromRGB(0,255,255))
    })
    beam.Parent = startPart
    return beam, a0, a1
end

-- RENDER LOOP
RS.RenderStepped:Connect(function()
    if getgenv().SilentAimbot then
        local head = getTarget()
        if head and LP.Character and LP.Character:FindFirstChild("Head") then
            if not myPart then myPart = createFollowPart(LP.Character.Head) end
            if not enemyPart then enemyPart = createFollowPart(head) end
            if not currentBeam then currentBeam, att0, att1 = createBeam(myPart, enemyPart) end

            myPart.CFrame = LP.Character.Head.CFrame
            enemyPart.CFrame = head.CFrame
        else
            if currentBeam then currentBeam:Destroy() end
            currentBeam, att0, att1 = nil,nil,nil
            if myPart then myPart:Destroy(); myPart=nil end
            if enemyPart then enemyPart:Destroy(); enemyPart=nil end
        end
    else
        if currentBeam then currentBeam:Destroy() end
        currentBeam, att0, att1 = nil,nil,nil
        if myPart then myPart:Destroy(); myPart=nil end
        if enemyPart then enemyPart:Destroy(); enemyPart=nil end
    end
end)

--== AimTab UI CONNECTIONS ==
-- Toggle Silent Aim
AimTab:Toggle({
    Title = "Silent Aim",
    Value = false,
    Desc = "‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î Silent Aim",
    Callback = function(v)
        getgenv().SilentAimbot = v
    end
})

-- Slider FOV
AimTab:Slider({
    Title = "FOV",
    Min = 50,
    Max = 500,
    Value = 120,
    Rounding = 0,
    Callback = function(v)
        getgenv().SAIM_FOV = v
    end
})

-- Toggle Show FOV
AimTab:Toggle({
    Title = "Show FOV",
    Value = true,
    Callback = function(v)
        getgenv().ShowFOV = v
    end
})

-- TEAM TOGGLES (Multi-team)
for _,teamName in pairs({"Neutral","Guards","Inmates","Criminals"}) do
    AimTab:Toggle({
        Title = teamName,
        Value = false,
        Callback = function(v)
            getgenv().SAIM_TEAM_LIST[teamName] = v
        end
    })
end
